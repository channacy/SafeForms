<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>SafeForms Run Report</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color:#0b3b2e; }
    h1 { color:#065f46; }
    .kpis { margin: 16px 0; padding:12px; border:1px solid #cce3db; border-radius:8px; }
    .row { margin:12px 0; padding:12px; border:1px solid #e5e7eb; border-radius:8px; }
    .badge { display:inline-block; padding:2px 8px; border-radius:12px; font-size:12px; border:1px solid #d1d5db; }
    .risk-low { background:#ecfdf5; color:#065f46; }
    .risk-medium { background:#fef3c7; color:#92400e; }
    .risk-high { background:#fee2e2; color:#991b1b; }
    .progress { width:160px; height:8px; background:#e5e7eb; border-radius:4px; overflow:hidden; display:inline-block; vertical-align:middle; }
    .bar { height:8px; background:#10b981; }
    .cit { font-size:12px; color:#374151; margin-left:8px; }
    .hash { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size:12px; color:#065f46; }
  </style>
</head>
<body>
  <h1>SafeForms Run Report</h1>
  <div class="kpis">
    <div><strong>Answered %:</strong> {{ kpis.answered_pct }}%</div>
    <div><strong>Total Questions:</strong> {{ kpis.total }}</div>
    <div><strong>Document Coverage:</strong> {{ kpis.doc_coverage }}</div>
  </div>

  {% for r in rows %}
    <div class="row">
      <div><strong>Question:</strong> {{ r.text }}</div>
      <div>
        <span class="badge">Final: {{ r.final or 'n/a' }}</span>
        <span class="badge">Verify: {{ r.verify_conf }}%</span>
        {% set risk_class = 'risk-low' if r.risk=='low' else ('risk-medium' if r.risk=='medium' else 'risk-high') %}
        <span class="badge {{ risk_class }}">Risk: {{ r.risk }}</span>
      </div>
      {% if r.citations and r.citations|length > 0 %}
        <div>
          <strong>Citations:</strong>
          <ul>
            {% for c in r.citations %}
              <li class="cit">{{ c.doc_id }} — “{{ c.quote }}”</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
      {% if r.approvals and r.approvals|length > 0 %}
        <div>
          <strong>Approvals:</strong>
          <ul>
            {% for a in r.approvals %}
              <li class="cit">{{ a.actor }} — {{ a.decision }}{% if a.reason %} ({{ a.reason }}){% endif %}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    </div>
  {% endfor %}
</body>
</html>
